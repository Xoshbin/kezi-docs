# المدفوعات: حركة الأموال وإدارة التدفق النقدي

يوضح هذا الدليل الشامل كيفية عمل المدفوعات في نظام المحاسبة، ويغطي الإنشاء والإدارة ودعم العملات المتعددة والتسوية. مكتوب لجميع المستخدمين — المحاسبين وغير المحاسبين — ويوفر إرشادات عملية تتبع أفضل ممارسات المحاسبة المزدوجة القيد.

---

## ما هو الدفع؟

الدفع يمثل حركة الأموال بين شركتك وشريك تجاري (عميل أو مورد). المدفوعات أساسية لإدارة التدفق النقدي وتسوية الحسابات المستحقة القبض/الدفع.

### أنواع المدفوعات
- **الدفع الداخل** — الأموال المستلمة من العملاء (يقلل الحسابات المستحقة القبض)
- **الدفع الخارج** — الأموال المرسلة للموردين (يقلل الحسابات المستحقة الدفع)

### فئات المدفوعات
- **دفع التسوية** — مرتبط بفواتير أو فواتير موردين محددة لتسوية المبالغ المستحقة
- **سلفة/ائتمان الشريك** — مدفوعات مستقلة لودائع العملاء أو سلف الموردين

كل دفع يتضمن:
- الدفتر (حساب البنك أو النقد حيث تحركت الأموال)
- تاريخ الدفع والعملة
- المبلغ في كل من عملة الدفع وعملة الشركة الأساسية
- طريقة الدفع والمرجع الاختياري
- معلومات الشريك وتتبع الحالة

---

## متطلبات النظام

### تكوين الدفتر
- **دفاتر البنك**: يجب تكوين دفتر بنك واحد على الأقل لمعالجة المدفوعات
- **طرق الدفع**: يجب إعداد طرق الدفع لخيارات المعالجة
- **إعداد العملة**: يجب أن تكون العملات نشطة وأسعار الصرف مكونة
- **سجلات الشركاء**: يجب أن يوجد العملاء والموردون لربط المدفوعات

### المتطلبات المسبقة
1. **إعداد الحساب المصرفي**: دفاتر البنك مكونة بشكل صحيح مع التكامل المحاسبي
2. **معلومات الشريك**: سجلات العملاء أو الموردين مُنشأة مع تفاصيل الدفع
3. **سجلات الفاتورة/الفاتورة**: للمدفوعات المرتبطة، يجب ترحيل الفواتير أو الفواتير
4. **أذونات المستخدم**: الوصول المناسب لميزات البنك والدفع

---

## أين تجدها في واجهة المستخدم

انتقل إلى **المحاسبة ← البنك والنقد ← المدفوعات**

تظهر المدفوعات أيضاً في:
- **فواتير العملاء**: إجراء "تسجيل الدفع" للفواتير المرحلة غير المدفوعة
- **فواتير الموردين**: إجراء "تسجيل الدفع" للفواتير المرحلة غير المدفوعة  
- **تسوية البنك**: المدفوعات المؤكدة متاحة للمطابقة مع كشوف البنك
- **لوحة القيادة**: نشاط الدفع الأخير وملخصات التدفق النقدي

**نصيحة**: زر المساعدة/المستندات في الرأس يفتح هذا الدليل.

---

## سير عمل حالة الدفع

تتبع المدفوعات سير عمل مُتحكم فيه لضمان سلامة البيانات:

### مسودة
- دفع تم إنشاؤه حديثاً، قابل للتحرير بالكامل
- يمكن تعديله أو حذفه
- لا تأثير محاسبي بعد
- لم يتم إنشاء قيود دفتر يومية

### مؤكد
- الدفع مكتمل ومُرحل للمحاسبة
- قيود الدفتر اليومية مُنشأة تلقائياً
- غير قابل للتغيير للحفاظ على مسار التدقيق
- لا يمكن تحريره أو حذفه
- أسعار الصرف مقفلة عند التأكيد

### مُسوى
- الدفع مطابق مع خط كشف البنك
- يؤكد حدوث المعاملة المصرفية الفعلية
- قيد دفتر يومية تسوية إضافي مُنشأ
- الحالة النهائية في سير العمل العادي

### ملغي
- دفع مؤكد تم عكسه
- قيد دفتر يومية عكسي مُنشأ
- يحافظ على مسار تدقيق كامل
- لا يمكن التراجع عنه بمجرد الإلغاء

**مهم**: يمكن تحرير أو حذف مدفوعات المسودة فقط. المدفوعات المؤكدة تتطلب إجراءات عكس مناسبة للحفاظ على سلامة المحاسبة.

---

## طرق الدفع

يدعم النظام طرق دفع متعددة:

- **يدوي** — إدخال يدوي عام
- **شيك** — مدفوعات الشيكات الورقية
- **تحويل بنكي** — تحويلات بنكية إلكترونية
- **بطاقة ائتمان** — معاملات بطاقة ائتمان
- **بطاقة خصم** — معاملات بطاقة خصم
- **نقد** — مدفوعات نقدية فعلية
- **تحويل برقي** — تحويلات برقية دولية
- **ACH** — تحويلات دار المقاصة الآلية
- **SEPA** — تحويلات منطقة المدفوعات الأوروبية الموحدة
- **دفع عبر الإنترنت** — منصات الدفع الرقمية

---

## إنشاء المدفوعات

### ١) دفع مستقل من قائمة المدفوعات

استخدم هذا لحركات الأموال غير المرتبطة مباشرة بفواتير/فواتير محددة (ودائع العملاء، سلف الموردين، أو مدفوعات فورية للربط لاحقاً).

**الخطوات:**
1. اذهب إلى **المحاسبة ← البنك والنقد ← المدفوعات**
2. انقر **إنشاء**
3. املأ نموذج الدفع:
   - **نوع الدفع**: اختر استلام (داخل) أو إرسال (خارج)
   - **الشريك**: اختر العميل أو المورد
   - **الدفتر**: اختر حساب البنك أو النقد
   - **تاريخ الدفع**: متى تحركت الأموال
   - **العملة والمبلغ**: عملة الدفع والمبلغ
   - **طريقة الدفع**: اختر من الطرق المتاحة
   - **المرجع**: ملاحظة داخلية أو مرجع بنكي اختياري
4. **حفظ** للإنشاء كمسودة
5. **تأكيد** عندما تكون جاهزاً للترحيل للمحاسبة

**النتيجة:**
- دفع مسودة مُنشأ وقابل للتحرير
- عند التأكيد، قيود الدفتر اليومية مُرحلة تلقائياً
- الدفع متاح للتسوية أو التسوية

### ٢) تسجيل دفع على فاتورة (دفع عميل)

استخدم هذا لتحصيل أموال لفواتير العملاء المرحلة.

**المتطلبات المسبقة:**
- يجب أن تكون الفاتورة مُرحلة (ليست مسودة)
- يجب أن يوجد مبلغ متبقي مستحق

**الخطوات:**
1. افتح الفاتورة المرحلة
2. انقر **تسجيل دفع** (أيقونة الأوراق النقدية)
3. املأ حوار الدفع:
   - **الدفتر**: عادة حسابك البنكي الرئيسي
   - **تاريخ الدفع**: متى تم استلام الأموال
   - **المبلغ**: افتراضي للمبلغ المتبقي؛ اضبط للمدفوعات الجزئية
   - **المرجع**: مرجع بنكي أو ملاحظة اختيارية
4. **تأكيد** لإنشاء وترحيل الدفع

**ما يحدث:**
- دفع داخل مُنشأ ومؤكد فوراً
- الدفع مرتبط بالفاتورة، يقلل المبلغ المستحق
- حالة الفاتورة تُحدث (مدفوع جزئياً أو مدفوع)
- قيود الدفتر اليومية مُرحلة تلقائياً
- الدفع متاح لتسوية البنك

### ٣) تسجيل دفع على فاتورة مورد (دفع مورد)

استخدم هذا لدفع فواتير الموردين المرحلة.

**المتطلبات المسبقة:**
- يجب أن تكون الفاتورة مُرحلة (ليست مسودة)
- يجب أن يوجد مبلغ متبقي مستحق

**الخطوات:**
1. افتح فاتورة المورد المرحلة
2. انقر **تسجيل دفع** (أيقونة الأوراق النقدية)
3. املأ حوار الدفع:
   - **الدفتر**: عادة حسابك البنكي الرئيسي
   - **تاريخ الدفع**: متى تم إرسال الأموال
   - **المبلغ**: افتراضي للمبلغ المتبقي؛ اضبط للمدفوعات الجزئية
   - **المرجع**: مرجع أو ملاحظة اختيارية
4. **تأكيد** لإنشاء وترحيل الدفع

**ما يحدث:**
- دفع خارج مُنشأ ومؤكد فوراً
- الدفع مرتبط بالفاتورة، يقلل المبلغ المستحق
- حالة الفاتورة تُحدث (مدفوع جزئياً أو مدفوع)
- قيود الدفتر اليومية مُرحلة تلقائياً
- الدفع متاح لتسوية البنك

---

## تأكيد الدفع والإدارة

### تأكيد المدفوعات

**مدفوعات المسودة** يمكن تأكيدها لترحيلها للمحاسبة:

1. افتح دفع المسودة
2. انقر **تأكيد الدفع**
3. أكد الإجراء عند المطالبة

**عند التأكيد:**
- قيود الدفتر اليومية مُنشأة تلقائياً
- أسعار الصرف مقفلة (للعملات المتعددة)
- الدفع يصبح غير قابل للتغيير
- الحالة تتغير إلى مؤكد

### قيود التحرير

- **مدفوعات المسودة**: قابلة للتحرير والحذف بالكامل
- **المدفوعات المؤكدة**: غير قابلة للتغيير، لا يمكن تحريرها أو حذفها
- **المدفوعات المُسواة**: حالة نهائية، لا تغييرات مسموحة

### قواعد الحذف

- **مدفوعات المسودة**: يمكن حذفها بأمان
- **المدفوعات المؤكدة/المُسواة**: لا يمكن حذفها
- استخدم الإلغاء للمدفوعات المؤكدة التي تتطلب عكس

---

## المدفوعات متعددة العملات

يتعامل النظام مع المدفوعات بأي عملة مكونة مع التحويل التلقائي:

### التعامل مع العملة
- **عملة الدفع**: العملة التي تم بها الدفع
- **عملة الشركة**: عملة شركتك الأساسية للتقرير
- **سعر الصرف**: مُلتقط تلقائياً عند تأكيد الدفع
- **التحويل**: تحويل تلقائي لعملة الشركة

### إدارة سعر الصرف
- الأسعار مُلتقطة في تاريخ الدفع
- مقفلة عند التأكيد لمنع التلاعب
- مُستخدمة لحسابات الربح/الخسارة المحققة
- معروضة في تفاصيل الدفع لمسار التدقيق

### أرباح/خسائر الصرف المحققة
عند تسوية فواتير/فواتير العملة الأجنبية:
- النظام يحسب الفرق بين أسعار الفاتورة والدفع
- قيود دفتر يومية تلقائية للأرباح/الخسائر المحققة
- مُرحلة لحسابات ربح/خسارة الصرف المكونة
- يحافظ على تقرير مالي دقيق

**مثال**: 
- فاتورة: ١٠٠٠ دولار أمريكي بسعر ١٣٠٠ دينار/دولار = ١٣٠٠٠٠٠ دينار
- دفع: ١٠٠٠ دولار أمريكي بسعر ١٣١٠ دينار/دولار = ١٣١٠٠٠٠ دينار
- خسارة محققة: ١٠٠٠٠ دينار مُرحل لحساب خسارة الصرف

---

## علاقات الدفع وروابط المستندات

### المستندات المرتبطة
يمكن ربط المدفوعات بمستندات متعددة:
- **الفواتير**: تسويات دفع العملاء
- **فواتير الموردين**: تسويات دفع الموردين
- **المبلغ المطبق**: تتبع مبالغ محددة مخصصة لكل مستند

### عرض العلاقات
كل دفع يُظهر معلومات ذات صلة:
- **تبويب الفواتير**: جميع فواتير العملاء المرتبطة
- **تبويب فواتير الموردين**: جميع فواتير الموردين المرتبطة
- **تبويب قيود الدفتر اليومية**: جميع القيود المحاسبية
- **تبويب خطوط كشف البنك**: تاريخ التسوية

### تسوية المستند
- المدفوعات يمكنها تسوية مستندات متعددة
- التسويات الجزئية مدعومة
- الأرصدة المتبقية مُتتبعة تلقائياً
- تاريخ التسوية محفوظ للتدقيق

---

## تسوية البنك

### عملية التسوية
1. استورد أو أنشئ كشوف البنك
2. انتقل إلى **المحاسبة ← البنك والنقد ← كشوف البنك**
3. افتح الكشف وانقر **سوّي**
4. طابق المدفوعات المؤكدة مع خطوط الكشف
5. النظام يُحدث حالة الدفع إلى مُسوى

### تأثيرات التسوية
- حالة الدفع تتغير إلى مُسوى
- خط كشف البنك مُعلم كمُسوى
- قيد دفتر يومية تسوية إضافي مُنشأ
- يؤكد حدوث المعاملة المصرفية الفعلية

### متطلبات التسوية
- يجب أن تكون المدفوعات مؤكدة قبل التسوية
- يجب أن تتطابق المبالغ بين الدفع وخط الكشف
- تحويل العملة يُتعامل معه تلقائياً
- مدفوعات متعددة يمكنها التسوية لخط كشف واحد

---

## أفضل الممارسات والنصائح

### إدارة الدفع
- **أكد بعناية**: المدفوعات المؤكدة لا يمكن تحريرها
- **استخدم المراجع**: أضف مراجع البنك لتسوية أسهل
- **التسوية المنتظمة**: احتفظ بالكتب متوافقة مع كشوف البنك
- **المدفوعات الجزئية**: استخدم لتحصيلات/مدفوعات الأقساط

### أفضل ممارسات العملات المتعددة
- **راقب أسعار الصرف**: تغييرات الأسعار الكبيرة تؤثر على التدفق النقدي
- **تحوط من مخاطر العملة**: اعتبر عقود آجلة للمبالغ الكبيرة
- **راجع الربح/الخسارة**: راقب تأثير ربح/خسارة الصرف على الربحية

### التدقيق والامتثال
- **احتفظ بالوثائق**: احتفظ بمستندات داعمة لجميع المدفوعات
- **راجع قيود الدفتر اليومية**: تحقق من التأثير المحاسبي للمدفوعات
- **امتثال تاريخ القفل**: احترم تواريخ قفل الفترة المحاسبية
- **فصل المهام**: فصل إنشاء وتأكيد الدفع

---

## استكشاف الأخطاء وإصلاحها

### المشاكل الشائعة

**س: لا يمكن تحرير الدفع المؤكد**
ج: المدفوعات المؤكدة غير قابلة للتغيير. أنشئ قيد عكسي إذا كانت التغييرات مطلوبة.

**س: الدفع لا يظهر في التسوية**
ج: تأكد أن الدفع مؤكد ويطابق عملة/مبلغ الكشف.

**س: سعر الصرف يبدو غير صحيح**
ج: أسعار الصرف مقفلة عند التأكيد. تحقق من مصدر السعر والتاريخ.

**س: لا يمكن حذف الدفع**
ج: يمكن حذف مدفوعات المسودة فقط. استخدم الإلغاء للمدفوعات المؤكدة.

### رسائل الخطأ

**"يمكن تأكيد مدفوعات المسودة فقط"**
- الدفع مؤكد بالفعل أو في حالة خاطئة
- أنعش الصفحة وتحقق من الحالة الحالية

**"تاريخ الدفع في فترة مقفلة"**
- تاريخ الدفع يقع ضمن فترة محاسبية مقفلة
- غيّر التاريخ أو اطلب فتح الفترة من المدير

**"مبلغ متبق غير كافٍ"**
- محاولة تطبيق أكثر من رصيد المستند المتبقي
- تحقق من حالة المستند والمدفوعات السابقة

---

## الأسئلة المتكررة

**س: هل يمكنني حذف دفع مؤكد؟**
ج: لا. المستندات المالية تصبح غير قابلة للتغيير بمجرد التأكيد للحفاظ على مسار التدقيق. استخدم الإلغاء للعكس.

**س: هل يمكنني عمل مدفوعات جزئية؟**
ج: نعم. أدخل مبلغ أصغر عند تسجيل الدفع. المستند يبقى مدفوع جزئياً مع رصيد محدث.

**س: كيف تعمل العملة الأجنبية؟**
ج: نحن نخزن المبالغ في كل من عملة الدفع والشركة. أرباح/خسائر الصرف محسوبة ومُرحلة تلقائياً عند تسوية المستندات.

**س: ما الفرق بين التسوية والمدفوعات المقدمة؟**
ج: مدفوعات التسوية مرتبطة بفواتير/فواتير محددة. المدفوعات المقدمة مستقلة ويمكن تطبيقها على مستندات مستقبلية.

**س: هل يمكن لدفع واحد تسوية فواتير متعددة؟**
ج: نعم. استخدم روابط المستندات لتخصيص مبالغ الدفع عبر فواتير أو فواتير متعددة.

**س: كيف أتعامل مع رسوم الدفع؟**
ج: سجل الرسوم منفصلة من خلال كشوف البنك أو قيود دفتر يومية متنوعة. مبالغ الدفع يجب أن تعكس المبالغ الصافية المستلمة/المرسلة.

---

## المصطلحات

- **الشريك**: عميل أو مورد في النظام
- **الدفتر**: حساب بنك أو نقد حيث تُسجل المعاملات
- **التسوية**: تطبيق الدفع على فاتورة أو فاتورة محددة
- **التسوية**: مطابقة مدفوعات النظام مع خطوط كشف البنك
- **رابط المستند**: اتصال بين الدفع والفاتورة/الفاتورة مع المبلغ المطبق
- **سعر الصرف**: سعر تحويل العملة مقفل عند تأكيد الدفع
- **الربح/الخسارة المحققة**: فرق الصرف عند تسوية مستندات العملة الأجنبية

---

هل تحتاج مزيد من المساعدة؟ استخدم زر المساعدة/المستندات في قسم المدفوعات أو اتصل بمدير النظام للحصول على دعم إضافي.

---

## استخدام شروط الدفع

### في فواتير العملاء

1. اذهب إلى **المحاسبة ← فواتير العملاء ← إنشاء فاتورة**
2. املأ تفاصيل الفاتورة الأساسية
3. اختر **شرط الدفع** من القائمة المنسدلة
4. سيستخدم النظام هذا الشرط لحساب الأقساط عند ترحيل الفاتورة

### في فواتير الموردين

1. اذهب إلى **المحاسبة ← فواتير الموردين ← إنشاء فاتورة مورد**
2. املأ تفاصيل الفاتورة الأساسية
3. اختر **شرط الدفع** من القائمة المنسدلة
4. سيستخدم النظام هذا الشرط لحساب الأقساط عند ترحيل الفاتورة

### عرض شروط الدفع

تُعرض شروط الدفع في عروض القوائم:
- **قائمة الفواتير**: تعرض اسم شرط الدفع في عمود مخصص
- **قائمة فواتير الموردين**: تعرض كلاً من شرط الدفع وتاريخ الاستحقاق المحسوب

## كيفية عمل شروط الدفع

### 1. إنشاء المستند
- يختار المستخدم شرط دفع عند إنشاء فاتورة أو فاتورة مورد
- يتم حفظ شرط الدفع مع المستند

### 2. ترحيل المستند
- عند ترحيل المستند، يقرأ النظام شرط الدفع
- يحسب الأقساط بناءً على تكوين شرط الدفع
- ينشئ سجلات أقساط الدفع تلقائياً

### 3. معالجة الدفع
- عند تسجيل المدفوعات، يتم تطبيقها على الأقساط
- تُحدث حالات الأقساط تلقائياً:
  - **معلق** ← **مدفوع جزئياً** ← **مدفوع**
  - **ملغي** (إذا تم إلغاء المستند)

### 4. تتبع الدفع
- يمكن للمستخدمين تتبع تقدم الدفع من خلال واجهات الدفع الموجودة
- يتم تحديد الأقساط المتأخرة تلقائياً
- تستخدم تقارير تقادم الدفع بيانات الأقساط

## أنواع شروط الدفع

### 1. الدفع الفوري
- الدفع مستحق فوراً عند الاستلام
- ينشئ قسط واحد بتاريخ استحقاق = تاريخ المستند

### 2. الشروط الصافية
- الدفع مستحق خلال عدد محدد من الأيام
- مثال: صافي 30 = الدفع مستحق في 30 يوماً
- ينشئ قسط واحد بتاريخ استحقاق محسوب

### 3. خصومات الدفع المبكر
- خصم متاح إذا تم الدفع خلال فترة الخصم
- مثال: 2% 10، صافي 30 = خصم 2% إذا تم الدفع خلال 10 أيام، وإلا صافي 30
- ينشئ قسط واحد مع معلومات الخصم

### 4. نهاية الشهر
- الدفع مستحق في نهاية الشهر (+ أيام إضافية اختيارية)
- مثال: EOM + 15 = الدفع مستحق 15 يوماً بعد نهاية الشهر
- يتعامل مع حسابات نهاية الشهر تلقائياً

### 5. يوم من الشهر
- الدفع مستحق في يوم محدد من الشهر التالي
- مثال: الخامس عشر من الشهر التالي = الدفع مستحق في الخامس عشر من الشهر التالي
- يتعامل مع انتقالات الشهور والسنوات الكبيسة

## أفضل الممارسات

### 1. التوحيد القياسي
- استخدام شروط دفع متسقة عبر العملاء/الموردين المتشابهين
- تعيين شروط دفع افتراضية على سجلات الشركاء
- مراجعة وتحديث الشروط بانتظام

### 2. إدارة التدفق النقدي
- استخدام شروط أقصر لتدفق نقدي أفضل
- تقديم خصومات دفع مبكر لتشجيع الدفع الأسرع
- النظر في شروط الأقساط للمبالغ الكبيرة

### 3. علاقات العملاء
- توضيح شروط الدفع للعملاء بوضوح
- الاتساق في تطبيق الشروط
- النظر في تاريخ دفع العميل عند تحديد الشروط

### 4. إدارة الموردين
- التفاوض على شروط دفع مواتية مع الموردين
- الاستفادة من خصومات الدفع المبكر عند الإمكان
- مراقبة شروط دفع الموردين لتخطيط التدفق النقدي

## التفاصيل التقنية

### هيكل قاعدة البيانات
- `payment_terms` - تعريفات شروط الدفع الرئيسية
- `payment_term_lines` - تكوينات الأقساط الفردية
- `payment_installments` - الأقساط المُنشأة للمستندات
- `payment_installment_links` - الروابط بين المدفوعات والأقساط

### الحسابات التلقائية
- تواريخ الاستحقاق محسوبة بناءً على تاريخ المستند وتكوين الشرط
- مبالغ الأقساط محسوبة مع التقريب المناسب
- أسعار الصرف مُسجلة لسيناريوهات العملات المتعددة
- مواعيد نهاية الخصم محسوبة تلقائياً

### نقاط التكامل
- **إنشاء الفاتورة/فاتورة المورد** - اختيار شرط الدفع
- **ترحيل المستند** - إنشاء الأقساط
- **تسجيل الدفع** - تحديثات حالة الأقساط
- **التقارير** - تحليل تقادم الدفع والتدفق النقدي

## استكشاف الأخطاء وإصلاحها

### شروط الدفع لا تظهر
- تأكد من أن شروط الدفع نشطة (`is_active = true`)
- تحقق من وجود شروط الدفع للشركة الحالية
- تشغيل `php artisan db:seed --class=PaymentTermsSeeder` لإنشاء الشروط الافتراضية

### الأقساط لا يتم إنشاؤها
- تحقق من أن المستند له شرط دفع مُعين
- تأكد من أن المستند تم ترحيله (ليس مسودة)
- تأكد من تكوين خطوط شروط الدفع بشكل صحيح

### تواريخ استحقاق خاطئة
- راجع تكوين خط شرط الدفع
- تحقق من صحة تاريخ المستند
- تحقق من نوع شرط الدفع وطريقة الحساب

## الدعم

للحصول على مساعدة إضافية مع نظام شروط الدفع:
1. تحقق من واجهة الإعدادات ← شروط الدفع
2. راجع تكوينات شروط الدفع الموجودة
3. اختبر مع مستندات عينة في بيئة التطوير
4. راجع الوثائق التقنية للتكوينات المتقدمة

## المستندات ذات الصلة

- [دليل فواتير العملاء](customer-invoices.ar.md) - تعلم المزيد حول إنشاء الفواتير
- [دليل فواتير الموردين](vendor-bills.ar.md) - تعلم المزيد حول إدارة فواتير الموردين
- [دليل المدفوعات](payments.ar.md) - تعلم المزيد حول معالجة المدفوعات

## أنواع شروط الدفع

### ١. الدفع الفوري
- الدفع مستحق فوراً عند الاستلام
- ينشئ قسط واحد بتاريخ استحقاق = تاريخ المستند

### ٢. الشروط الصافية
- الدفع مستحق خلال عدد محدد من الأيام
- مثال: صافي ٣٠ = الدفع مستحق في ٣٠ يوماً
- ينشئ قسط واحد بتاريخ استحقاق محسوب

### ٣. خصومات الدفع المبكر
- خصم متاح إذا تم الدفع خلال فترة الخصم
- مثال: 2% ١٠، صافي ٣٠ = خصم 2% إذا تم الدفع خلال ١٠ أيام، وإلا صافي ٣٠
- ينشئ قسط واحد مع معلومات الخصم

### ٤. نهاية الشهر
- الدفع مستحق في نهاية الشهر (+ أيام إضافية اختيارية)
- مثال: EOM + ١٥ = الدفع مستحق ١٥ يوماً بعد نهاية الشهر
- يتعامل مع حسابات نهاية الشهر تلقائياً

### ٥. يوم من الشهر
- الدفع مستحق في يوم محدد من الشهر التالي
- مثال: الخامس عشر من الشهر التالي = الدفع مستحق في الخامس عشر من الشهر التالي
- يتعامل مع انتقالات الشهور والسنوات الكبيسة

## أفضل الممارسات

### ١. التوحيد القياسي
- استخدام شروط دفع متسقة عبر العملاء/الموردين المتشابهين
- تعيين شروط دفع افتراضية على سجلات الشركاء
- مراجعة وتحديث الشروط بانتظام

### ٢. إدارة التدفق النقدي
- استخدام شروط أقصر لتدفق نقدي أفضل
- تقديم خصومات دفع مبكر لتشجيع الدفع الأسرع
- النظر في شروط الأقساط للمبالغ الكبيرة

### ٣. علاقات العملاء
- توضيح شروط الدفع للعملاء بوضوح
- الاتساق في تطبيق الشروط
- النظر في تاريخ دفع العميل عند تحديد الشروط

### ٤. إدارة الموردين
- التفاوض على شروط دفع مواتية مع الموردين
- الاستفادة من خصومات الدفع المبكر عند الإمكان
- مراقبة شروط دفع الموردين لتخطيط التدفق النقدي

## التفاصيل التقنية

### هيكل قاعدة البيانات
- `payment_terms` - تعريفات شروط الدفع الرئيسية
- `payment_term_lines` - تكوينات الأقساط الفردية
- `payment_installments` - الأقساط المُنشأة للمستندات
- `payment_installment_links` - الروابط بين المدفوعات والأقساط

### الحسابات التلقائية
- تواريخ الاستحقاق محسوبة بناءً على تاريخ المستند وتكوين الشرط
- مبالغ الأقساط محسوبة مع التقريب المناسب
- أسعار الصرف مُسجلة لسيناريوهات العملات المتعددة
- مواعيد نهاية الخصم محسوبة تلقائياً

### نقاط التكامل
- **إنشاء الفاتورة/الفاتورة** - اختيار شرط الدفع
- **ترحيل المستند** - إنشاء الأقساط
- **تسجيل الدفع** - تحديثات حالة الأقساط
- **التقارير** - تحليل تقادم الدفع والتدفق النقدي

## استكشاف الأخطاء وإصلاحها

### شروط الدفع لا تظهر
- تأكد من أن شروط الدفع نشطة (`is_active = true`)
- تحقق من وجود شروط الدفع للشركة الحالية
- تشغيل `php artisan db:seed --class=PaymentTermsSeeder` لإنشاء الشروط الافتراضية

### الأقساط لا يتم إنشاؤها
- تحقق من أن المستند له شرط دفع مُعين
- تأكد من أن المستند تم ترحيله (ليس مسودة)
- تأكد من تكوين خطوط شروط الدفع بشكل صحيح

### تواريخ استحقاق خاطئة
- راجع تكوين خط شرط الدفع
- تحقق من صحة تاريخ المستند
- تحقق من نوع شرط الدفع وطريقة الحساب

## الدعم

للحصول على مساعدة إضافية مع نظام شروط الدفع:
١. تحقق من واجهة الإعدادات ← شروط الدفع
٢. راجع تكوينات شروط الدفع الموجودة
٣. اختبر مع مستندات عينة في بيئة التطوير
٤. راجع الوثائق التقنية للتكوينات المتقدمة

## روابط ذات صلة

- [دليل الفواتير](customer-invoices.ar.md) - لمعرفة المزيد حول إنشاء الفواتير
- [دليل فواتير الموردين](vendor-bills.md) - لمعرفة المزيد حول فواتير الموردين  
- [دليل المدفوعات](payments.ar.md) - لمعرفة المزيد حول معالجة المدفوعات
